<?xml version="1.0" encoding="utf-8" standalone="yes"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>Python on Pheglovog</title><link>https://pheglovog.github.io/pheglovog-site/tags/python/</link><description>Recent content in Python on Pheglovog</description><generator>Hugo</generator><language>zh-CN</language><lastBuildDate>Sun, 01 Feb 2026 00:00:00 +0000</lastBuildDate><atom:link href="https://pheglovog.github.io/pheglovog-site/tags/python/index.xml" rel="self" type="application/rss+xml"/><item><title>AlphaQuant 中国股市量化系统开发总结</title><link>https://pheglovog.github.io/pheglovog-site/posts/alphquant-summary/</link><pubDate>Sun, 01 Feb 2026 00:00:00 +0000</pubDate><guid>https://pheglovog.github.io/pheglovog-site/posts/alphquant-summary/</guid><description>&lt;h2 id="项目概述">项目概述&lt;/h2>
&lt;p>AlphaQuant 是一个基于符号回归的中国股市量化交易系统，专注于因子挖掘和策略回测。&lt;/p>
&lt;h2 id="核心模块">核心模块&lt;/h2>
&lt;h3 id="1-数据管道-data-pipeline">1. 数据管道 (Data Pipeline)&lt;/h3>
&lt;ul>
&lt;li>Tushare Pro 异步接口&lt;/li>
&lt;li>并发控制（支持 2000 积分 = 5 并发）&lt;/li>
&lt;li>429 错误重试（指数退避）&lt;/li>
&lt;li>API 数据解析&lt;/li>
&lt;/ul>
&lt;h3 id="2-因子引擎-factor-engine">2. 因子引擎 (Factor Engine)&lt;/h3>
&lt;ul>
&lt;li>6 维基础因子（RET, PRESSURE, FOMO, DEV, VOL, AMP）&lt;/li>
&lt;li>18 维高级因子（RSI, MACD, 布林带, ATR, 北向资金等）&lt;/li>
&lt;li>24 维总因子空间&lt;/li>
&lt;/ul>
&lt;h3 id="3-回测引擎-backtest-engine">3. 回测引擎 (Backtest Engine)&lt;/h3>
&lt;ul>
&lt;li>T+1 交易规则&lt;/li>
&lt;li>涨跌停限制（主板10%、创业板20%、科创板20%、北交所30%）&lt;/li>
&lt;li>交易成本（佣金、印花税、过户费）&lt;/li>
&lt;li>滑点模型&lt;/li>
&lt;/ul>
&lt;h3 id="4-alphaquant-模型">4. AlphaQuant 模型&lt;/h3>
&lt;ul>
&lt;li>QK-Norm 注意力&lt;/li>
&lt;li>SwiGLU 前馈网络&lt;/li>
&lt;li>RMSNorm 归一化&lt;/li>
&lt;li>市场情绪编码&lt;/li>
&lt;li>多任务学习（收益、夏普、回撤）&lt;/li>
&lt;/ul>
&lt;h3 id="5-策略管理器">5. 策略管理器&lt;/h3>
&lt;ul>
&lt;li>信号生成&lt;/li>
&lt;li>持仓管理&lt;/li>
&lt;li>风险控制（止损止盈、移动止损）&lt;/li>
&lt;li>仓位计算&lt;/li>
&lt;/ul>
&lt;h3 id="6-可视化面板">6. 可视化面板&lt;/h3>
&lt;ul>
&lt;li>Streamlit 可视化&lt;/li>
&lt;li>权益曲线&lt;/li>
&lt;li>回撤曲线&lt;/li>
&lt;li>收益分布&lt;/li>
&lt;li>交易记录&lt;/li>
&lt;/ul>
&lt;h2 id="技术栈">技术栈&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>语言&lt;/strong>: Python&lt;/li>
&lt;li>&lt;strong>深度学习&lt;/strong>: PyTorch&lt;/li>
&lt;li>&lt;strong>数据处理&lt;/strong>: Pandas, NumPy&lt;/li>
&lt;li>&lt;strong>数据源&lt;/strong>: Tushare Pro (2000 积分)&lt;/li>
&lt;li>&lt;strong>可视化&lt;/strong>: Streamlit, Matplotlib&lt;/li>
&lt;li>&lt;strong>规范&lt;/strong>: OpenSpec&lt;/li>
&lt;/ul>
&lt;h2 id="项目地址">项目地址&lt;/h2>
&lt;p>&lt;a href="https://github.com/Pheglovog/AlphaGPT">GitHub&lt;/a>&lt;/p></description></item><item><title>Tushare Pro 2000 积分配置指南</title><link>https://pheglovog.github.io/pheglovog-site/posts/tushare-guide/</link><pubDate>Sat, 31 Jan 2026 00:00:00 +0000</pubDate><guid>https://pheglovog.github.io/pheglovog-site/posts/tushare-guide/</guid><description>&lt;h2 id="tushare-pro-简介">Tushare Pro 简介&lt;/h2>
&lt;p>Tushare Pro 是中国股市最全面的数据接口平台，提供股票行情、财务数据、宏观经济等数据。&lt;/p>
&lt;h2 id="积分说明">积分说明&lt;/h2>
&lt;ul>
&lt;li>&lt;strong>2000 积分&lt;/strong>: 每日可调用 3000 次，并发限制 5&lt;/li>
&lt;li>&lt;strong>5000 积分&lt;/strong>: 每日可调用 10000 次，并发限制 10&lt;/li>
&lt;li>&lt;strong>更高积分&lt;/strong>: 更多调用次数和并发数&lt;/li>
&lt;/ul>
&lt;h2 id="配置步骤">配置步骤&lt;/h2>
&lt;h3 id="1-注册账号">1. 注册账号&lt;/h3>
&lt;p>访问 &lt;a href="https://tushare.pro">https://tushare.pro&lt;/a> 注册账号并登录&lt;/p>
&lt;h3 id="2-获取-token">2. 获取 Token&lt;/h3>
&lt;ol>
&lt;li>进入「用户中心」→「接口TOKEN」&lt;/li>
&lt;li>复制 Token&lt;/li>
&lt;/ol>
&lt;h3 id="3-配置环境变量">3. 配置环境变量&lt;/h3>
&lt;p>创建 &lt;code>.env&lt;/code> 文件：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-env" data-lang="env">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#79c0ff">TUSHARE_TOKEN&lt;/span>&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>your_token_here
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="4-python-代码示例">4. Python 代码示例&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">import&lt;/span> &lt;span style="color:#ff7b72">tushare&lt;/span> &lt;span style="color:#ff7b72">as&lt;/span> &lt;span style="color:#ff7b72">ts&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">import&lt;/span> &lt;span style="color:#ff7b72">os&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">from&lt;/span> &lt;span style="color:#ff7b72">dotenv&lt;/span> &lt;span style="color:#ff7b72">import&lt;/span> load_dotenv
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>load_dotenv()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 初始化 API&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ts&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>set_token(os&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>getenv(&lt;span style="color:#a5d6ff">&amp;#39;TUSHARE_TOKEN&amp;#39;&lt;/span>))
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pro &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> ts&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>pro_api()
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 获取股票列表&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>stock_list &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> pro&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>stock_basic(exchange&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;&amp;#39;&lt;/span>, list_status&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;L&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>print(stock_list&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>head())
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="429-错误处理">429 错误处理&lt;/h2>
&lt;h3 id="问题">问题&lt;/h3>
&lt;p>当请求频率超过限制时，会收到 429 错误。&lt;/p>
&lt;h3 id="解决方案指数退避重试">解决方案：指数退避重试&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">import&lt;/span> &lt;span style="color:#ff7b72">asyncio&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">import&lt;/span> &lt;span style="color:#ff7b72">aiohttp&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">from&lt;/span> &lt;span style="color:#ff7b72">tenacity&lt;/span> &lt;span style="color:#ff7b72">import&lt;/span> retry, stop_after_attempt, wait_exponential
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d2a8ff;font-weight:bold">@retry&lt;/span>(
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> stop&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>stop_after_attempt(&lt;span style="color:#a5d6ff">5&lt;/span>),
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> wait&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>wait_exponential(multiplier&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">1&lt;/span>, min&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">2&lt;/span>, max&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">60&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">async&lt;/span> &lt;span style="color:#ff7b72">def&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">fetch_tushare_data&lt;/span>(url, params):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">async&lt;/span> &lt;span style="color:#ff7b72">with&lt;/span> aiohttp&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>ClientSession() &lt;span style="color:#ff7b72">as&lt;/span> session:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">async&lt;/span> &lt;span style="color:#ff7b72">with&lt;/span> session&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>get(url, params&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>params) &lt;span style="color:#ff7b72">as&lt;/span> response:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">if&lt;/span> response&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>status &lt;span style="color:#ff7b72;font-weight:bold">==&lt;/span> &lt;span style="color:#a5d6ff">429&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">raise&lt;/span> &lt;span style="color:#f0883e;font-weight:bold">Exception&lt;/span>(&lt;span style="color:#a5d6ff">&amp;#34;Rate limited&amp;#34;&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">return&lt;/span> &lt;span style="color:#ff7b72">await&lt;/span> response&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>json()
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="并发控制">并发控制&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">import&lt;/span> &lt;span style="color:#ff7b72">asyncio&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">from&lt;/span> &lt;span style="color:#ff7b72">asyncio&lt;/span> &lt;span style="color:#ff7b72">import&lt;/span> Semaphore
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 限制并发数为 5&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>semaphore &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> Semaphore(&lt;span style="color:#a5d6ff">5&lt;/span>)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#ff7b72">async&lt;/span> &lt;span style="color:#ff7b72">def&lt;/span> &lt;span style="color:#d2a8ff;font-weight:bold">fetch_with_semaphore&lt;/span>(url, params):
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">async&lt;/span> &lt;span style="color:#ff7b72">with&lt;/span> semaphore:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ff7b72">return&lt;/span> &lt;span style="color:#ff7b72">await&lt;/span> fetch_tushare_data(url, params)
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8b949e;font-style:italic"># 批量获取数据&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>tasks &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> [fetch_with_semaphore(url, params) &lt;span style="color:#ff7b72">for&lt;/span> _ &lt;span style="color:#ff7b72;font-weight:bold">in&lt;/span> range(&lt;span style="color:#a5d6ff">100&lt;/span>)]
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>results &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> &lt;span style="color:#ff7b72">await&lt;/span> asyncio&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>gather(&lt;span style="color:#ff7b72;font-weight:bold">*&lt;/span>tasks)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="常用-api">常用 API&lt;/h2>
&lt;h3 id="获取日线行情">获取日线行情&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>df &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> pro&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>daily(ts_code&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;000001.SZ&amp;#39;&lt;/span>, start_date&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;20240101&amp;#39;&lt;/span>, end_date&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;20240201&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="获取财务指标">获取财务指标&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>df &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> pro&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>fina_indicator(ts_code&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;000001.SZ&amp;#39;&lt;/span>, start_date&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;20240101&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="获取北向资金">获取北向资金&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#e6edf3;background-color:#0d1117;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-python" data-lang="python">&lt;span style="display:flex;">&lt;span>df &lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span> pro&lt;span style="color:#ff7b72;font-weight:bold">.&lt;/span>moneyflow_hsgt(start_date&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;20240101&amp;#39;&lt;/span>, end_date&lt;span style="color:#ff7b72;font-weight:bold">=&lt;/span>&lt;span style="color:#a5d6ff">&amp;#39;20240201&amp;#39;&lt;/span>)
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="总结">总结&lt;/h2>
&lt;p>Tushare Pro 是量化交易的重要工具，合理配置并发控制和错误处理可以提高数据获取效率。&lt;/p></description></item></channel></rss>